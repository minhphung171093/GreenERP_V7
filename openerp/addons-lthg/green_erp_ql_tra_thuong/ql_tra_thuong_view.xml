<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    	
    	<menuitem name="QL Trả Thưởng" id="ql_tra_thuong" sequence="11"/>
        <menuitem name="Trả thưởng" id="menu_tra_thuong" parent="ql_tra_thuong" sequence="5"/>
        
        <record id="tra_thuong_filter" model="ir.ui.view">
            <field name="name">tra.thuong.filter</field>
            <field name="model">tra.thuong</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Trả thưởng">
                    <field name="daily_id"/>
                    <field name="ngay"/>
                    <field name="state"/>
                    <filter icon="terp-go-year" string="Mới tạo" name="moitao" domain="[('state','=','new')]" />
                    <filter icon="terp-go-year" string="Đã hết hạn" name="dataohethan" domain="[('state','=','done')]" />
                    <group expand="0" string="Group By...">
                        <filter name="group_daily_id" string="Theo đại lý" icon="terp-personal" domain="[]" context="{'group_by':'daily_id'}"/>
                        <filter name="group_thang" string="Theo tháng" icon="terp-personal" domain="[]" context="{'group_by':'ngay'}"/>
                        <!--<filter name="group_state" string="Theo trạng thái" icon="terp-personal" domain="[]" context="{'group_by':'state'}"/>-->
                    </group>
                </search>
            </field>
        </record>
        
        <record id="tra_thuong_tree" model="ir.ui.view">
            <field name="name">tra.thuong.tree</field>
            <field name="model">tra.thuong</field>
            <field name="arch" type="xml">
                <tree string="Trả thưởng" create='false' edit='false'>
                    <field name="daily_id"/>
                    <field name="ngay"/>
                    <field name="state" invisible='1'/>
                </tree>
            </field>
        </record>
    	
		<record id="tra_thuong_form" model="ir.ui.view">
            <field name="name">tra.thuong.form</field>
            <field name="model">tra.thuong</field>
            <field name="arch" type="xml">
                <form string="Trả thưởng" version="7.0" create='false' edit='false'>
                	<header>
                		<button name="chinhsua" string="Chỉnh sửa" type="object" class="oe_highlight"/>
	                    <field name="state" invisible='1' widget="statusbar" statusbar_visible="new,done" statusbar_colors='{"new":"blue","done":"blue"}'/>
	                </header>
	                <sheet string="Trả thưởng">
	                    <group>
		                    <group>
		                        <field name="daily_id"/>
		                    </group>
		                    <group>
		                        <field name="ngay" required='1'/>
		                    </group>
	                    </group>
	                    <notebook>
	                    	<page string="Chi tiết trả thưởng">
			                    <group>
			                        <field name="tra_thuong_line" nolabel='1'>
			                        	<tree editable='bottom'>
			                        		<field name="product_id"/>
					                        <field name="name"/>
					                        <field name="loai"/>
					                        <field name="giai"/>
					                        <field name="sl_trung"/>
					                        <field name="slan_trung"/>
					                        <field name="tong_tien"/>
					                        <field name="tong"/>
			                        	</tree>
			                        </field>
			                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
		                                <div class="oe_subtotal_footer_separator oe_inline">
		                                    <label for="tong_cong" />
		                                </div>
		                                <field name="tong_cong" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary'/>
		                            </group>
		                            <div class="oe_clear"/>
			                    </group>
		                    </page>
		                    <page string="Thông tin biên bản chỉnh sửa">
		                    	<group>
				                    <group>
				                        <field name="so_vanban"/>
				                    </group>
				                    <group>
				                        <field name="date"/>
				                    </group>
			                    </group>
		                    </page>
		                    <page string="Lịch sử">
			                    <group>
			                        <field name="lichsu_line" nolabel='1'>
			                        	<tree editable='bottom' create="false" edit="false">
			                        		<field name="daily_id"/>
						                    <field name="ngay"/>
						                    <field name="tong_cong"/>
						                    <field name="state" invisible='1'/>
			                        	</tree>
			                        	<form string="Trả thưởng" version="7.0" create="false" edit="false">
						                	<header>
							                    <field name="state" widget="statusbar" statusbar_visible="new,done" statusbar_colors='{"new":"blue","done":"blue"}'/>
							                </header>
							                <sheet string="Trả thưởng">
							                    <group>
								                    <group>
								                        <field name="daily_id"/>
								                    </group>
								                    <group>
								                        <field name="ngay" required='1'/>
								                    </group>
							                    </group>
							                    <notebook>
							                    	<page string="Chi tiết trả thưởng">
									                    <group>
									                        <field name="tra_thuong_line" nolabel='1'>
									                        	<tree editable='bottom'>
									                        		<field name="product_id"/>
											                        <field name="name"/>
											                        <field name="loai"/>
											                        <field name="giai"/>
											                        <field name="sl_trung"/>
											                        <field name="slan_trung"/>
											                        <field name="tong_tien"/>
											                        <field name="tong"/>
									                        	</tree>
									                        </field>
									                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
								                                <div class="oe_subtotal_footer_separator oe_inline">
								                                    <label for="tong_cong" />
								                                </div>
								                                <field name="tong_cong" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary'/>
								                            </group>
								                            <div class="oe_clear"/>
									                    </group>
								                    </page>
								                    <page string="Thông tin biên bản chỉnh sửa">
								                    	<group>
										                    <group>
										                        <field name="so_vanban"/>
										                    </group>
										                    <group>
										                        <field name="date"/>
										                    </group>
									                    </group>
								                    </page>
							                    </notebook>
							                </sheet>
						                </form>
			                        </field>
			                    </group>
		                    </page>
	                    </notebook>
	                </sheet>
                </form>
            </field>
        </record>
        
        <record id="action_tra_thuong" model="ir.actions.act_window">
            <field name="name">Trả thưởng</field>
            <field name="res_model">tra.thuong</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="tra_thuong_tree"/>
            <field name="context">{'search_default_group_thang':1}</field>
            <field name="domain">[('parent_id','=',False)]</field>
        </record>
        <record id="action_tra_thuong1" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="tra_thuong_tree"/>
            <field name="act_window_id" ref="action_tra_thuong"/>
        </record>
        <record id="action_tra_thuong2" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="tra_thuong_form"/>
            <field name="act_window_id" ref="action_tra_thuong"/>
        </record>
        <record id="chinhsua_tra_thuong_form" model="ir.ui.view">
            <field name="name">chinhsua.tra.thuong.form</field>
            <field name="model">tra.thuong</field>
            <field name="arch" type="xml">
                <form string="Trả thưởng" version="7.0">
	                <sheet string="Trả thưởng">
	                    <group>
		                    <group>
		                        <field name="daily_id"/>
		                    </group>
		                    <group>
		                        <field name="ngay" required='1'/>
		                        <field name="state" invisible='1'/>
		                    </group>
	                    </group>
	                    <notebook>
	                    	<page string="Chi tiết trả thưởng">
			                    <group>
			                        <field name="tra_thuong_line" nolabel='1'>
			                        	<tree editable='bottom'>
			                        		<field name="product_id"/>
					                        <field name="name"/>
					                        <field name="loai"/>
					                        <field name="giai"/>
					                        <field name="sl_trung"/>
					                        <field name="slan_trung"/>
					                        <field name="tong_tien"/>
					                        <field name="tong"/>
			                        	</tree>
			                        </field>
			                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
		                                <div class="oe_subtotal_footer_separator oe_inline">
		                                    <label for="tong_cong" />
		                                </div>
		                                <field name="tong_cong" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary'/>
		                            </group>
		                            <div class="oe_clear"/>
			                    </group>
		                    </page>
	                    </notebook>
	                </sheet>
	                <footer>
                        <button name="save" string="Lưu" type="object" class="oe_highlight"/>
                        hoặc
                        <button string="Hủy bỏ" class="oe_link" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>
        
        <menuitem action="action_tra_thuong" id="menu_action_tra_thuong" parent="menu_tra_thuong" sequence="20"/>
        
        <record id="tra_thuong_thucte_filter" model="ir.ui.view">
            <field name="name">tra.thuong.thucte.filter</field>
            <field name="model">tra.thuong.thucte</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Trả thưởng thực tế">
                    <field name="daily_id"/>
                    <field name="ngay"/>
                    <field name="nguoi_nhan_thuong"/>
                    <field name="journal_id"/>
                    <field name="ngay_tra_thuong"/>
                    <field name="state"/>
                    <filter icon="terp-go-year" string="Mới tạo" name="moitao" domain="[('state','=','new')]" />
                    <filter icon="terp-go-year" string="Đã tạo phiếu chi" name="dataophieuchi" domain="[('state','=','done')]" />
                    <group expand="0" string="Group By...">
                        <filter name="group_daily_id" string="Theo đại lý" icon="terp-personal" domain="[]" context="{'group_by':'daily_id'}"/>
                        <filter name="group_nguoi_nhan_thuong" string="Theo người nhận thưởng" icon="terp-personal" domain="[]" context="{'group_by':'nguoi_nhan_thuong'}"/>
                        <filter name="group_journal_id" string="Theo phương thức thanh toán" icon="terp-personal" domain="[]" context="{'group_by':'journal_id'}"/>
                        <filter name="group_thang_xs" string="Theo tháng xổ số" icon="terp-personal" domain="[]" context="{'group_by':'ngay'}"/>
                        <filter name="group_thang_nt" string="Theo tháng nhận thưởng" icon="terp-personal" domain="[]" context="{'group_by':'ngay_tra_thuong'}"/>
                        <filter name="group_state" string="Theo trạng thái" icon="terp-personal" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="tra_thuong_thucte_tree" model="ir.ui.view">
            <field name="name">tra.thuong.thucte.tree</field>
            <field name="model">tra.thuong.thucte</field>
            <field name="arch" type="xml">
                <tree string="Trả thưởng thực tế">
                    <field name="daily_id"/>
                    <field name="nguoi_nhan_thuong"/>
                    <field name="journal_id"/>
                    <field name="ngay"/>
                    <field name="ngay_tra_thuong"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
    	
		<record id="tra_thuong_thucte_form" model="ir.ui.view">
            <field name="name">tra.thuong.thucte.form</field>
            <field name="model">tra.thuong.thucte</field>
            <field name="arch" type="xml">
                <form string="Trả thưởng thực tế" version="7.0">
                	<header>
                        <button name="tao_phieu_chi" type="object" states="new" string="Tạo phiếu chi" class="oe_highlight"/>
	                    <button name="quan_ly_duyet" string="Quản lý duyệt" attrs="{'invisible':[('show_manager_check','=',False)]}" type="object" class="oe_highlight"/>
	                    <field name="state" widget="statusbar" statusbar_visible="new,done" statusbar_colors='{"new":"blue","done":"blue"}'/>
						<field name="show_manager_check" invisible='1'/>
	                </header>
	                <sheet string="Trả thưởng">
	                    <group>
		                    <group>
		                        <field name="daily_id"/>
		                        <field name="nguoi_nhan_thuong"/>
		                        <field name="journal_id" domain="[('type','in',['cash','bank'])]"/>
		                    </group>
		                    <group>
		                        <field name="ngay"/>
		                        <field name="ngay_tra_thuong"/>
		                    </group>
	                    </group>
	                    <group>
	                        <field name="tra_thuong_line" nolabel='1'>
	                        	<tree editable='bottom'>
	                        		<field name="product_id" on_change="onchange_product(product_id,name,loai,giai,parent.ngay,sl_trung)"/>
	                        		<field name="name" on_change="onchange_product(product_id,name,loai,giai,parent.ngay,sl_trung)"/>
			                        <field name="loai" on_change="onchange_product(product_id,name,loai,giai,parent.ngay,sl_trung)"/>
			                        <field name="giai" on_change="onchange_product(product_id,name,loai,giai,parent.ngay,sl_trung)"/>
			                        <field name="sl_trung" on_change="onchange_product(product_id,name,loai,giai,parent.ngay,sl_trung)"/>
			                        <field name="slan_trung"/>
			                        <field name="tong_tien"/>
			                        <field name="tong"/>
	                        	</tree>
	                        </field>
	                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                                <div class="oe_subtotal_footer_separator oe_inline">
                                    <label for="tong_cong" />
                                </div>
                                <field name="tong_cong" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary'/>
                            </group>
                            <div class="oe_clear"/>
	                    </group>
	                </sheet>
                </form>
            </field>
        </record>
        
        <record id="action_tra_thuong_thucte" model="ir.actions.act_window">
            <field name="name">Trả thưởng thực tế</field>
            <field name="res_model">tra.thuong.thucte</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="tra_thuong_thucte_tree"/>
            <field name="context">{'search_default_moitao':1}</field>
        </record>
        
        <menuitem action="action_tra_thuong_thucte" id="menu_action_tra_thuong_thucte" parent="menu_tra_thuong" sequence="30"/>
        
    </data>
</openerp>

